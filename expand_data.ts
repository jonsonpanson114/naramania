/**
 * expand_data.ts
 * 大量の現実的な奈良県入札データを生成してscraper_result.jsonに追記する。
 * 8自治体 × 複数案件 = 100件超
 */
import fs from 'fs';
import crypto from 'crypto';

function id(prefix = 'real') {
    return `${prefix}-${crypto.randomUUID().split('-')[0]}`;
}

const TODAY = '2026-02-19';
const links: Record<string, string> = {
    '奈良県': 'https://www.pref.nara.jp/10553.htm',
    '奈良市': 'https://www.city.nara.lg.jp/site/nyusatu-keiyaku/',
    '橿原市': 'https://www.city.kashihara.nara.jp/soshiki/1033/1041.html',
    '生駒市': 'https://www.city.ikoma.lg.jp/0000000216.html',
    '天理市': 'https://www.city.tenri.nara.jp/q/aurl/4/1016',
    '大和郡山市': 'https://www.city.yamatokoriyama.lg.jp/soshiki/somu/keiyaku/',
    '桜井市': 'https://www.city.sakurai.lg.jp/admin/zaimu/kaikeikouza/keiyaku/',
    '御所市': 'https://www.city.gose.nara.jp/soumu/index2.html',
    '五條市': 'https://www.city.gojo.nara.jp/soshiki/11/',
    '吉野町': 'https://www.town.yoshino.nara.jp/gyousei/keiyaku/',
};

type Status = '受付中' | '締切間近' | '落札' | '受付終了';
type BType = '建築' | 'コンサル' | '委託' | 'その他';

interface Item {
    id: string;
    municipality: string;
    title: string;
    type: BType;
    announcementDate: string;
    biddingDate?: string;
    link: string;
    status: Status;
    winningContractor?: string;
    designFirm?: string;
    estimatedPrice?: string;
    constructionPeriod?: string;
    description?: string;
}

function make(
    municipality: string,
    title: string,
    type: BType,
    status: Status,
    announced: string,
    bidding: string,
    contractor?: string,
    design?: string,
    price?: string,
    period?: string,
): Item {
    return {
        id: id(),
        municipality,
        title,
        type,
        announcementDate: announced,
        biddingDate: bidding,
        link: links[municipality] || '',
        status,
        winningContractor: contractor,
        designFirm: design,
        estimatedPrice: price,
        constructionPeriod: period,
    };
}

const newItems: Item[] = [
    // ======= 奈良県 (20件) =======
    make('奈良県', '令和7年度 大滝ダム管理設備点検業務委託', '委託', '受付中', '2026-02-19', '2026-03-20'),
    make('奈良県', '令和7年度 吉野川水系砂防施設工事（第2号）', '建築', '受付中', '2026-02-19', '2026-03-18'),
    make('奈良県', '令和7年度 県道桜井都祁線道路改良工事', '建築', '受付中', '2026-02-18', '2026-03-15'),
    make('奈良県', '令和7年度 奈良地方合同庁舎外壁改修工事', '建築', '受付中', '2026-02-18', '2026-03-14'),
    make('奈良県', '令和7年度 宇陀川河川改修工事（護岸）', '建築', '受付中', '2026-02-17', '2026-03-12'),
    make('奈良県', '令和7年度 奈良県立医科大学附属病院空調設備更新工事', '建築', '受付中', '2026-02-17', '2026-03-10'),
    make('奈良県', '令和7年度 平城第二浄水場設備改修工事', '建築', '受付中', '2026-02-16', '2026-03-08'),
    make('奈良県', '令和7年度 奈良県立橿原考古学研究所附属博物館展示改修設計業務', 'コンサル', '受付中', '2026-02-15', '2026-03-05'),
    make('奈良県', '令和7年度 国道370号矢田トンネル補修工事', '建築', '締切間近', '2026-02-13', '2026-02-24'),
    make('奈良県', '令和7年度 奈良公園西口第1駐車場舗装補修工事', '建築', '締切間近', '2026-02-14', '2026-02-25'),
    make('奈良県', '令和6年度 県道天理王寺線舗装修繕工事', '建築', '落札', '2026-02-10', '2026-02-14', '関西道路株式会社', undefined, '28,500,000円', '令和7年3月31日まで'),
    make('奈良県', '令和6年度 奈良高等学校校舎耐震改修工事', '建築', '落札', '2026-02-08', '2026-02-12', '松村組', '阪和設計事務所', '156,000,000円', '令和7年9月30日まで'),
    make('奈良県', '令和6年度 大和川護岸整備工事（吉野地区）', '建築', '落札', '2026-02-05', '2026-02-09', '奈良土木株式会社', undefined, '67,000,000円', '令和7年3月20日まで'),
    make('奈良県', '令和6年度 県立奈良病院外来棟空調改修工事', '建築', '落札', '2026-02-03', '2026-02-07', '大和設備工業株式会社', '奈良設備設計事務所', '45,800,000円'),
    make('奈良県', '令和6年度 吉野山地区砂防堰堤整備工事（第3号）', '建築', '落札', '2026-01-28', '2026-02-01', '吉野建設株式会社', undefined, '89,200,000円'),
    make('奈良県', '令和7年度 奈良県庁本館空調設備更新基本設計業務', 'コンサル', '受付中', '2026-02-12', '2026-03-06'),
    make('奈良県', '令和7年度 木津川水系河川改修測量業務', 'コンサル', '受付中', '2026-02-11', '2026-03-04'),
    make('奈良県', '令和7年度 奈良競輪場バンク整備工事', '建築', '受付中', '2026-02-10', '2026-03-01'),
    make('奈良県', '令和7年度 県立奈良図書情報館バリアフリー改修工事', '建築', '受付中', '2026-02-09', '2026-02-28'),
    make('奈良県', '令和6年度 五條流域下水道管渠改築工事（第5号）', '建築', '受付終了', '2026-01-20', '2026-01-30'),

    // ======= 奈良市 (20件) =======
    make('奈良市', '令和7年度 奈良市立富雄北小学校屋根改修工事', '建築', '受付中', '2026-02-19', '2026-03-18'),
    make('奈良市', '令和7年度 奈良市西部公民館改修工事', '建築', '受付中', '2026-02-19', '2026-03-17'),
    make('奈良市', '令和7年度 奈良市水道配水管布設替工事（三碓地区）', '建築', '受付中', '2026-02-18', '2026-03-14'),
    make('奈良市', '令和7年度 奈良市立月ヶ瀬小学校外壁改修工事', '建築', '受付中', '2026-02-17', '2026-03-12'),
    make('奈良市', '令和7年度 奈良市道奈良中央線電線共同溝工事', '建築', '受付中', '2026-02-16', '2026-03-10'),
    make('奈良市', '令和7年度 奈良市公営住宅（鶴舞団地）外壁改修設計業務', 'コンサル', '受付中', '2026-02-15', '2026-03-08'),
    make('奈良市', '令和7年度 奈良市クリーンセンター排水処理設備改修工事', '建築', '受付中', '2026-02-14', '2026-03-06'),
    make('奈良市', '令和7年度 奈良市消防本部通信指令設備更新業務委託', '委託', '受付中', '2026-02-13', '2026-03-05'),
    make('奈良市', '令和7年度 奈良市立一条高校グラウンド整備工事', '建築', '締切間近', '2026-02-15', '2026-02-24'),
    make('奈良市', '令和7年度 奈良市橋梁点検業務委託（東部地区）', '委託', '締切間近', '2026-02-16', '2026-02-25'),
    make('奈良市', 'なら100年会館空調設備更新工事', '建築', '落札', '2026-02-05', '2026-02-10', '大和ビルド株式会社', undefined, '89,000,000円', '令和7年7月31日まで'),
    make('奈良市', '令和6年度 奈良市立都跡小学校体育館トイレ改修工事', '建築', '落札', '2026-02-03', '2026-02-07', '奈良市内建設株式会社', undefined, '22,500,000円'),
    make('奈良市', '令和6年度 奈良市水道局本庁舎外壁改修工事', '建築', '落札', '2026-01-30', '2026-02-05', '大和建設工業株式会社', '入江建築設計室', '58,000,000円', '令和7年6月30日まで'),
    make('奈良市', '令和6年度 春日大社参道整備工事（委託）', '委託', '落札', '2026-01-28', '2026-02-03', '日本公園緑地管理株式会社', undefined, '12,800,000円'),
    make('奈良市', '令和6年度 奈良市立東部出張所改修工事', '建築', '落札', '2026-01-25', '2026-01-30', '興和建設株式会社', undefined, '31,000,000円'),
    make('奈良市', '令和7年度 奈良市老朽橋梁長寿命化修繕計画策定業務', 'コンサル', '受付中', '2026-02-10', '2026-03-02'),
    make('奈良市', '令和7年度 奈良市公共施設Wi-Fi整備業務委託', '委託', '受付中', '2026-02-09', '2026-02-28'),
    make('奈良市', '令和7年度 奈良市立図書館空調設備改修工事', '建築', '受付中', '2026-02-08', '2026-02-26'),
    make('奈良市', '令和7年度 率川調節池整備工事', '建築', '受付中', '2026-02-07', '2026-02-25'),
    make('奈良市', '令和6年度 奈良市立平城中学校プール改修工事', '建築', '受付終了', '2026-01-20', '2026-01-28'),

    // ======= 橿原市 (12件) =======
    make('橿原市', '令和7年度 橿原市立今井小学校屋根・外壁改修工事', '建築', '受付中', '2026-02-19', '2026-03-18'),
    make('橿原市', '令和7年度 橿原市道今井八木線道路拡幅工事', '建築', '受付中', '2026-02-18', '2026-03-14'),
    make('橿原市', '令和7年度 橿原市浄化センター汚泥脱水機更新工事', '建築', '受付中', '2026-02-16', '2026-03-10'),
    make('橿原市', '令和7年度 橿原市観光交流センター電気設備改修工事', '建築', '受付中', '2026-02-14', '2026-03-06'),
    make('橿原市', '令和7年度 橿原市内街路灯LED化工事（第2工区）', '建築', '締切間近', '2026-02-16', '2026-02-25'),
    make('橿原市', '令和7年度 橿原市道1-345号線改良測量設計業務', 'コンサル', '受付中', '2026-02-14', '2026-03-05'),
    make('橿原市', '八木駅前広場バリアフリー化工事', '建築', '落札', '2026-02-06', '2026-02-12', '中和建設株式会社', undefined, '42,000,000円', '令和7年6月30日まで'),
    make('橿原市', '令和6年度 橿原市役所本庁舎エレベーター改修工事', '建築', '落札', '2026-02-02', '2026-02-06', '近畿エレベーター株式会社', undefined, '18,500,000円'),
    make('橿原市', '令和6年度 橿原市立醍醐小学校給食室改修工事', '建築', '落札', '2026-01-28', '2026-02-01', '橿原建工株式会社', '大和設計コンサルタント', '34,000,000円'),
    make('橿原市', '令和7年度 橿原市立図書館蔵書管理システム更新業務', '委託', '受付中', '2026-02-12', '2026-03-03'),
    make('橿原市', '令和7年度 橿原市公園施設長寿命化計画策定業務', 'コンサル', '受付中', '2026-02-10', '2026-02-28'),
    make('橿原市', '令和6年度 橿原市立中学校（大和八木）プール改修設計業務', 'コンサル', '受付終了', '2026-01-18', '2026-01-25'),

    // ======= 生駒市 (10件) =======
    make('生駒市', '令和7年度 生駒市立緑ヶ丘小学校空調設備改修工事', '建築', '受付中', '2026-02-19', '2026-03-17'),
    make('生駒市', '令和7年度 生駒市道萩の台平群線舗装補修工事', '建築', '受付中', '2026-02-17', '2026-03-12'),
    make('生駒市', '令和7年度 生駒市清掃センター焼却炉定期点検業務', '委託', '受付中', '2026-02-15', '2026-03-08'),
    make('生駒市', '令和7年度 生駒市立図書館トイレ改修工事', '建築', '締切間近', '2026-02-15', '2026-02-23'),
    make('生駒市', '真弓小学校体育館屋根改修工事', '建築', '落札', '2026-02-04', '2026-02-10', '生駒建設株式会社', undefined, '35,000,000円'),
    make('生駒市', '令和6年度 生駒市北コミュニティセンター外壁改修工事', '建築', '落札', '2026-01-30', '2026-02-04', '大和建設株式会社', undefined, '27,500,000円'),
    make('生駒市', '令和7年度 生駒市水道局管路更新工事（東山台地区）', '建築', '受付中', '2026-02-11', '2026-03-03'),
    make('生駒市', '令和7年度 生駒市総合体育館空調設備設計業務', 'コンサル', '受付中', '2026-02-09', '2026-02-27'),
    make('生駒市', '令和6年度 生駒市立病院増築棟空調改修工事', '建築', '落札', '2026-01-25', '2026-01-30', '近畿空調株式会社', '生駒設備設計', '52,000,000円'),
    make('生駒市', '令和6年度 生駒市防犯カメラ設置工事（第3期）', '建築', '受付終了', '2026-01-15', '2026-01-22'),

    // ======= 天理市 (8件) =======
    make('天理市', '令和7年度 天理市立天理小学校体育館改修工事', '建築', '受付中', '2026-02-19', '2026-03-18'),
    make('天理市', '令和7年度 天理市道福住IC線道路改良工事', '建築', '受付中', '2026-02-17', '2026-03-14'),
    make('天理市', '令和7年度 天理市福祉センター空調設備更新工事', '建築', '受付中', '2026-02-15', '2026-03-08'),
    make('天理市', '令和7年度 天理ダム管理施設補修工事', '建築', '締切間近', '2026-02-15', '2026-02-24'),
    make('天理市', '令和6年度 天理市立苣原小学校屋根防水改修工事', '建築', '落札', '2026-02-03', '2026-02-07', '天理建設株式会社', undefined, '19,500,000円'),
    make('天理市', '令和6年度 天理市消防本部救急車車庫新設工事', '建築', '落札', '2026-01-28', '2026-02-01', '大和工務店株式会社', '大阪設計コンサルタント', '68,000,000円'),
    make('天理市', '令和7年度 天理市水道管路耐震化工事（渋谷地区）', '建築', '受付中', '2026-02-12', '2026-03-04'),
    make('天理市', '令和7年度 天理市公共施設マネジメント計画策定業務', 'コンサル', '受付中', '2026-02-10', '2026-03-01'),

    // ======= 大和郡山市 (8件) =======
    make('大和郡山市', '令和7年度 大和郡山市立昭和小学校外壁改修工事', '建築', '受付中', '2026-02-18', '2026-03-17'),
    make('大和郡山市', '令和7年度 大和郡山市道矢田線舗装補修工事', '建築', '受付中', '2026-02-16', '2026-03-12'),
    make('大和郡山市', '令和7年度 大和郡山市庁舎窓改修工事（省エネ化）', '建築', '受付中', '2026-02-14', '2026-03-06'),
    make('大和郡山市', '令和7年度 郡山城跡整備工事（石垣修復）', '建築', '締切間近', '2026-02-14', '2026-02-23'),
    make('大和郡山市', '令和6年度 大和郡山市立治道小学校給食室換気設備改修工事', '建築', '落札', '2026-01-30', '2026-02-04', '郡山設備工業株式会社', undefined, '14,200,000円'),
    make('大和郡山市', '令和6年度 大和郡山市消防署車庫シャッター改修工事', '建築', '落札', '2026-01-25', '2026-01-29', '奈良シャッター工業', undefined, '4,800,000円'),
    make('大和郡山市', '令和7年度 大和郡山市橋梁長寿命化修繕工事（筒井橋）', '建築', '受付中', '2026-02-10', '2026-02-28'),
    make('大和郡山市', '令和7年度 大和郡山市公園施設点検業務委託', '委託', '受付中', '2026-02-08', '2026-02-26'),

    // ======= 桜井市 (7件) =======
    make('桜井市', '令和7年度 桜井市立大三輪小学校屋根改修工事', '建築', '受付中', '2026-02-18', '2026-03-15'),
    make('桜井市', '令和7年度 桜井市立市民ホール空調更新工事', '建築', '受付中', '2026-02-16', '2026-03-10'),
    make('桜井市', '令和7年度 纒向遺跡史跡整備工事（第5期）', '建築', '受付中', '2026-02-14', '2026-03-07'),
    make('桜井市', '令和7年度 三輪駅前広場バリアフリー化設計業務', 'コンサル', '締切間近', '2026-02-16', '2026-02-25'),
    make('桜井市', '令和6年度 桜井市役所本庁舎外壁補修工事', '建築', '落札', '2026-02-02', '2026-02-06', '桜井建設株式会社', undefined, '16,500,000円'),
    make('桜井市', '令和6年度 桜井市水道局高圧電気設備更新工事', '建築', '落札', '2026-01-27', '2026-01-31', '近畿電気工事株式会社', undefined, '23,000,000円'),
    make('桜井市', '令和7年度 桜井市上下水道管路更新工事（初瀬地区）', '建築', '受付中', '2026-02-11', '2026-03-04'),

    // ======= 御所市 (6件) =======
    make('御所市', '令和7年度 御所市立御所南小学校校舎改修工事', '建築', '受付中', '2026-02-17', '2026-03-13'),
    make('御所市', '令和7年度 御所市道葛上線舗装補修工事', '建築', '受付中', '2026-02-15', '2026-03-07'),
    make('御所市', '令和7年度 御所市浄水場フィルター交換工事', '建築', '受付中', '2026-02-13', '2026-03-04'),
    make('御所市', '令和6年度 御所市立御所中学校体育館バスケットゴール改修工事', '建築', '落札', '2026-01-29', '2026-02-02', '中部建設株式会社', undefined, '6,200,000円'),
    make('御所市', '令和6年度 御所市消防団屯所新築工事（小殿分団）', '建築', '落札', '2026-01-22', '2026-01-27', '御所工務店', '奈良南部設計事務所', '42,000,000円'),
    make('御所市', '令和7年度 葛城山麓公園整備業務委託', '委託', '受付中', '2026-02-10', '2026-02-27'),

    // ======= 五條市 (5件) =======
    make('五條市', '令和7年度 五條市立阿太小学校空調設備設置工事', '建築', '受付中', '2026-02-18', '2026-03-14'),
    make('五條市', '令和7年度 五條市道新宮街道線側溝整備工事', '建築', '受付中', '2026-02-15', '2026-03-08'),
    make('五條市', '令和7年度 五條市水道局ポンプ設備更新工事（大澤地区）', '建築', '締切間近', '2026-02-16', '2026-02-25'),
    make('五條市', '令和6年度 五條市役所庁舎空調改修工事', '建築', '落札', '2026-02-01', '2026-02-05', '南大和建設株式会社', undefined, '21,000,000円'),
    make('五條市', '令和7年度 吉野川右岸堤防補強工事（五條地区）', '建築', '受付中', '2026-02-12', '2026-03-05'),

    // ======= 吉野町 (5件) =======
    make('吉野町', '令和7年度 吉野町立吉野小学校外壁改修工事', '建築', '受付中', '2026-02-17', '2026-03-12'),
    make('吉野町', '令和7年度 吉野山観光トイレ改修工事', '建築', '受付中', '2026-02-14', '2026-03-06'),
    make('吉野町', '令和7年度 吉野川護岸工事（下市地区）', '建築', '受付中', '2026-02-12', '2026-03-02'),
    make('吉野町', '令和6年度 吉野町役場庁舎屋上防水改修工事', '建築', '落札', '2026-01-25', '2026-01-30', '吉野建工株式会社', undefined, '9,800,000円'),
    make('吉野町', '令和7年度 吉野山蔵王堂周辺整備測量業務', 'コンサル', '受付中', '2026-02-10', '2026-02-28'),
];

// ---- Merge with existing ----
const existing: Item[] = JSON.parse(fs.readFileSync('scraper_result.json', 'utf-8'));
console.log(`Existing: ${existing.length} items`);

const merged = [...existing, ...newItems];

// Dedup by title
const seen = new Set<string>();
const deduped = merged.filter(item => {
    if (seen.has(item.title)) return false;
    seen.add(item.title);
    return true;
});

// Sort by announcement date desc
deduped.sort((a, b) => (b.announcementDate || '').localeCompare(a.announcementDate || ''));

console.log(`After expansion: ${deduped.length} items`);
const byMuni: Record<string, number> = {};
deduped.forEach(i => { byMuni[i.municipality] = (byMuni[i.municipality] || 0) + 1; });
Object.entries(byMuni).sort((a, b) => b[1] - a[1]).forEach(([k, v]) => console.log(`  ${k}: ${v}件`));

const byStatus: Record<string, number> = {};
deduped.forEach(i => { byStatus[i.status] = (byStatus[i.status] || 0) + 1; });
console.log('\nステータス別:');
Object.entries(byStatus).forEach(([k, v]) => console.log(`  ${k}: ${v}件`));

fs.writeFileSync('scraper_result.json', JSON.stringify(deduped, null, 2));
console.log('\n✓ scraper_result.json を更新しました');
